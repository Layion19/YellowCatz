<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Yellow Admin</title>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      min-height: 100vh;
      background: #1a1a1a;
      font-family: Arial, sans-serif;
      color: #fff;
      padding: 20px;
    }

    .login-container {
      max-width: 400px;
      margin: 100px auto;
      text-align: center;
    }

    .login-container h1 {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 48px;
      color: #E8A000;
      margin-bottom: 30px;
    }

    .login-container input {
      width: 100%;
      padding: 15px;
      font-size: 16px;
      border: 2px solid #E8A000;
      background: transparent;
      color: #fff;
      border-radius: 8px;
      margin-bottom: 15px;
    }

    .login-container button {
      width: 100%;
      padding: 15px;
      font-size: 16px;
      background: #E8A000;
      color: #1a1a1a;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }

    .login-container button:hover {
      background: #ffb700;
    }

    .dashboard {
      display: none;
      max-width: 1200px;
      margin: 0 auto;
    }

    .dashboard.visible {
      display: block;
    }

    .dashboard h1 {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 48px;
      color: #E8A000;
      margin-bottom: 30px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    .stat-card {
      background: #2a2a2a;
      padding: 25px;
      border-radius: 12px;
      text-align: center;
      border: 2px solid #3a3a3a;
    }

    .stat-card .number {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 48px;
      color: #E8A000;
    }

    .stat-card .label {
      font-size: 14px;
      color: #888;
      margin-top: 5px;
    }

    .section {
      background: #2a2a2a;
      padding: 25px;
      border-radius: 12px;
      margin-bottom: 20px;
    }

    .section h2 {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 24px;
      color: #E8A000;
      margin-bottom: 20px;
    }

    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .tab-btn {
      padding: 10px 20px;
      background: #3a3a3a;
      border: none;
      border-radius: 6px;
      color: #fff;
      cursor: pointer;
      font-size: 14px;
    }

    .tab-btn:hover, .tab-btn.active {
      background: #E8A000;
      color: #1a1a1a;
    }

    .user-list {
      max-height: 400px;
      overflow-y: auto;
    }

    .user-item {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 12px;
      border-bottom: 1px solid #3a3a3a;
    }

    .user-item:last-child {
      border-bottom: none;
    }

    .user-item img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
    }

    .user-item .username {
      font-weight: bold;
      color: #E8A000;
    }

    .user-item .meta {
      font-size: 12px;
      color: #888;
    }

    .badge-filter {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .badge-filter select, .badge-filter input {
      padding: 10px;
      background: #3a3a3a;
      border: none;
      border-radius: 6px;
      color: #fff;
      font-size: 14px;
    }

    .error {
      color: #ff4444;
      margin-top: 10px;
    }

    .logout-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 10px 20px;
      background: #3a3a3a;
      border: none;
      border-radius: 6px;
      color: #fff;
      cursor: pointer;
    }

    .logout-btn:hover {
      background: #E8A000;
      color: #1a1a1a;
    }

    .export-btn {
      padding: 10px 20px;
      background: #E8A000;
      border: none;
      border-radius: 6px;
      color: #1a1a1a;
      cursor: pointer;
      font-weight: bold;
      margin-top: 15px;
    }
  </style>
</head>
<body>

<!-- LOGIN -->
<div class="login-container" id="loginContainer">
  <h1>üîí YELLOW ADMIN</h1>
  <input type="password" id="passwordInput" placeholder="Enter admin password">
  <button onclick="login()">Access Dashboard</button>
  <p class="error" id="loginError"></p>
</div>

<!-- DASHBOARD -->
<div class="dashboard" id="dashboard">
  <button class="logout-btn" onclick="logout()">Logout</button>
  
  <h1>üê± YELLOW ADMIN DASHBOARD</h1>

  <!-- STATS CARDS -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="number" id="totalUsers">-</div>
      <div class="label">Total Users</div>
    </div>
    <div class="stat-card">
      <div class="number" id="ogBadges">-</div>
      <div class="label">OG Badges</div>
    </div>
    <div class="stat-card">
      <div class="number" id="totalBadges">-</div>
      <div class="label">Badges Distributed</div>
    </div>
  </div>

  <!-- BADGE STATS -->
  <div class="section">
    <h2>üìä Badges Distribution</h2>
    <div id="badgeStats"></div>
  </div>

  <!-- USERS BY BADGE -->
  <div class="section">
    <h2>üë• Users by Badge</h2>
    <div class="badge-filter">
      <select id="badgeSelect" onchange="loadUsersByBadge()">
        <option value="og">OG</option>
        <option value="badge_2">Badge 2</option>
        <option value="badge_3">Badge 3</option>
        <option value="badge_4">Badge 4</option>
        <option value="badge_5">Badge 5</option>
        <option value="badge_6">Badge 6</option>
        <option value="badge_7">Badge 7</option>
        <option value="badge_8">Badge 8</option>
        <option value="badge_9">Badge 9</option>
        <option value="badge_10">Badge 10</option>
      </select>
    </div>
    <div class="user-list" id="usersByBadge"></div>
  </div>

  <!-- USERS WITH X BADGES -->
  <div class="section">
    <h2>üèÜ Users with Multiple Badges</h2>
    <div class="badge-filter">
      <label>Minimum badges:</label>
      <input type="number" id="minBadges" value="5" min="1" max="10" style="width:60px">
      <button class="tab-btn" onclick="loadUsersWithBadges()">Filter</button>
    </div>
    <div class="user-list" id="usersWithBadges"></div>
    <button class="export-btn" onclick="exportUsers()">üìã Export Usernames</button>
  </div>

  <!-- RECENT USERS -->
  <div class="section">
    <h2>üïê Recent Users</h2>
    <div class="user-list" id="recentUsers"></div>
  </div>
</div>

<script>
let adminPassword = '';

async function login() {
  const password = document.getElementById('passwordInput').value;
  
  try {
    const res = await fetch('/api/admin/stats', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ password, action: 'stats' })
    });

    if (!res.ok) {
      document.getElementById('loginError').textContent = 'Invalid password';
      return;
    }

    adminPassword = password;
    document.getElementById('loginContainer').style.display = 'none';
    document.getElementById('dashboard').classList.add('visible');
    
    loadDashboard();
  } catch (err) {
    document.getElementById('loginError').textContent = 'Connection error';
  }
}

function logout() {
  adminPassword = '';
  document.getElementById('loginContainer').style.display = 'block';
  document.getElementById('dashboard').classList.remove('visible');
  document.getElementById('passwordInput').value = '';
}

async function apiCall(action, extraData = {}) {
  const res = await fetch('/api/admin/stats', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ password: adminPassword, action, ...extraData })
  });
  return res.json();
}

async function loadDashboard() {
  const data = await apiCall('stats');
  
  document.getElementById('totalUsers').textContent = data.totalUsers || 0;
  
  // Badge stats
  let ogCount = 0;
  let totalBadges = 0;
  let badgeHTML = '<div style="display:flex;flex-wrap:wrap;gap:15px;">';
  
  data.badgeStats.forEach(b => {
    totalBadges += Number(b.count);
    if (b.badge_id === 'og') ogCount = b.count;
    badgeHTML += `
      <div style="background:#3a3a3a;padding:10px 15px;border-radius:6px;">
        <strong style="color:#E8A000">${b.badge_id.toUpperCase()}</strong>: ${b.count} users
      </div>
    `;
  });
  badgeHTML += '</div>';
  
  document.getElementById('ogBadges').textContent = ogCount;
  document.getElementById('totalBadges').textContent = totalBadges;
  document.getElementById('badgeStats').innerHTML = badgeHTML;
  
  // Recent users
  let recentHTML = '';
  data.recentUsers.forEach(u => {
    recentHTML += `
      <div class="user-item">
        <img src="${u.avatar_url || 'https://abs.twimg.com/sticky/default_profile_images/default_profile_normal.png'}">
        <div>
          <div class="username">@${u.x_username}</div>
          <div class="meta">${new Date(u.created_at).toLocaleDateString()}</div>
        </div>
      </div>
    `;
  });
  document.getElementById('recentUsers').innerHTML = recentHTML || '<p>No users yet</p>';
  
  // Load first badge users
  loadUsersByBadge();
}

async function loadUsersByBadge() {
  const badgeId = document.getElementById('badgeSelect').value;
  const data = await apiCall('usersByBadge', { badgeId });
  
  let html = '';
  data.users.forEach(u => {
    html += `
      <div class="user-item">
        <img src="${u.avatar_url || 'https://abs.twimg.com/sticky/default_profile_images/default_profile_normal.png'}">
        <div>
          <div class="username">@${u.x_username}</div>
          <div class="meta">Unlocked: ${new Date(u.unlocked_at).toLocaleDateString()}</div>
        </div>
      </div>
    `;
  });
  document.getElementById('usersByBadge').innerHTML = html || '<p>No users with this badge</p>';
}

async function loadUsersWithBadges() {
  const minBadges = document.getElementById('minBadges').value;
  const data = await apiCall('usersWithAllBadges', { minBadges: Number(minBadges) });
  
  let html = '';
  data.users.forEach(u => {
    html += `
      <div class="user-item">
        <img src="${u.avatar_url || 'https://abs.twimg.com/sticky/default_profile_images/default_profile_normal.png'}">
        <div>
          <div class="username">@${u.x_username}</div>
          <div class="meta">${u.total_badges} badges</div>
        </div>
      </div>
    `;
  });
  document.getElementById('usersWithBadges').innerHTML = html || '<p>No users with ' + minBadges + '+ badges</p>';
}

function exportUsers() {
  const items = document.querySelectorAll('#usersWithBadges .username');
  const usernames = Array.from(items).map(el => el.textContent).join('\n');
  
  if (!usernames) {
    alert('No users to export');
    return;
  }
  
  navigator.clipboard.writeText(usernames);
  alert('Usernames copied to clipboard!');
}

// Enter key to login
document.getElementById('passwordInput').addEventListener('keypress', (e) => {
  if (e.key === 'Enter') login();
});
</script>
</body>
</html>
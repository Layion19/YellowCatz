<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Yellow World</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box}

body{
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:#E8A000;
  font-family:Arial,sans-serif;
  overflow:hidden;
}

/* ---------- HAMBURGER MENU ---------- */
#hamburger-menu {
  display: none;
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 100;
}

#hamburger-btn {
  width: 50px;
  height: 50px;
  background: #8B5A00;
  border: none;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  gap: 5px;
  transition: 0.3s;
}

#hamburger-btn:hover {
  background: #6B4A00;
}

#hamburger-btn span {
  display: block;
  width: 22px;
  height: 2px;
  background: #E8A000;
  transition: 0.3s;
}

#hamburger-btn.open span:nth-child(1) {
  transform: rotate(45deg) translate(5px, 5px);
}

#hamburger-btn.open span:nth-child(2) {
  opacity: 0;
}

#hamburger-btn.open span:nth-child(3) {
  transform: rotate(-45deg) translate(5px, -5px);
}

#nav-menu {
  position: absolute;
  top: 60px;
  right: 0;
  background: #8B5A00;
  border-radius: 12px;
  padding: 10px 0;
  min-width: 180px;
  opacity: 0;
  visibility: hidden;
  transform: translateY(-10px);
  transition: 0.3s;
}

#nav-menu.open {
  opacity: 1;
  visibility: visible;
  transform: translateY(0);
}

#nav-menu a {
  display: block;
  padding: 12px 20px;
  color: #E8A000;
  text-decoration: none;
  font-size: 14px;
  transition: 0.2s;
}

#nav-menu a:hover {
  background: rgba(232, 160, 0, 0.2);
}

#nav-menu .divider {
  height: 1px;
  background: rgba(232, 160, 0, 0.3);
  margin: 5px 0;
}

/* ---------- USER BAR ---------- */
#user-bar{
  position:fixed;
  top:20px;
  left:20px;
  display:none;
  align-items:center;
  gap:10px;
  z-index:20;
}

#user-avatar{
  width:36px;
  height:36px;
  border-radius:50%;
}

#user-name {
  color: #8B5A00;
  font-weight: bold;
  font-size: 14px;
}

#status-dot{
  position:absolute;
  bottom:0;
  right:0;
  width:8px;
  height:8px;
  background:#00c853;
  border-radius:50%;
  border:2px solid #E8A000;
}

/* ---------- MAIN ---------- */
.container{
  text-align:center;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
}

.play-btn{
  width:80px;height:80px;border-radius:50%;
  border:3px solid #8B5A00;
  background:transparent;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:.5s;
  z-index:2;
}

.play-btn.hidden{opacity:0;pointer-events:none;transform:scale(.8)}
.play-btn svg{width:30px;height:30px;fill:#8B5A00;margin-left:5px}

.text-container{
  position:absolute;
  display:flex;
  flex-direction:column;
  align-items:center;
  opacity:0;
  transition:.5s;
  pointer-events:none;
}

.text-container.visible{
  opacity:1;
  pointer-events:auto;
}

.welcome-text{
  font-family:'Bebas Neue',sans-serif;
  font-size:72px;
  letter-spacing:12px;
  color:#8B5A00;
  margin-bottom:20px;
}

.enter-text{
  font-family:'Bebas Neue',sans-serif;
  font-size:32px;
  letter-spacing:4px;
  color:#8B5A00;
  margin-bottom:30px;
}

.small-text{
  font-size:14px;
  color:#8B5A00;
  opacity:.7;
  font-style:italic;
}

.cursor{
  display:inline-block;
  width:3px;
  height:1em;
  background:#8B5A00;
  margin-left:2px;
  animation:blink .7s infinite;
}

@keyframes blink{0%,50%{opacity:1}51%,100%{opacity:0}}

.x-connect{
  margin-top:50px;
  display:flex;
  flex-direction:column;
  align-items:center;
  opacity:0;
  transform:translateY(20px);
  transition:.8s;
  pointer-events:none;
}

.x-connect.visible{opacity:1;transform:translateY(0);pointer-events:auto}

.x-btn{
  width:60px;height:60px;
  border-radius:50%;
  border:2px solid #8B5A00;
  background:transparent;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
}

.x-btn svg{width:28px;height:28px;fill:#8B5A00}

.connect-text {
  margin-top: 10px;
  color: #8B5A00;
  font-size: 12px;
}

/* ---------- BADGES ---------- */
#badges-section{
  display:none;
  margin-top:40px;
  text-align:center;
}

.badges-title{
  font-size:14px;
  letter-spacing:1px;
  color:#8B5A00;
}

.badges-sub{
  font-size:12px;
  color:#8B5A00;
  opacity:.7;
  margin-bottom:20px;
}

#badges-grid{
  display:flex;
  justify-content:center;
  gap:14px;
  flex-wrap:wrap;
}

.badge{
  width:46px;height:46px;
  border-radius:50%;
  background:#777;
  opacity:.4;
  cursor:pointer;
  transition:.3s;
}

.badge.unlocked{
  background:#FFD000;
  opacity:1;
}

#badge-info{
  margin-top:10px;
  display:none;
}

#badge-name{
  font-weight:bold;
  color:#8B5A00;
}

#badge-description{
  font-size:12px;
  color:#8B5A00;
  opacity:.7;
}
</style>
</head>

<body>

<!-- HAMBURGER MENU -->
<div id="hamburger-menu">
  <button id="hamburger-btn" onclick="toggleMenu()">
    <span></span>
    <span></span>
    <span></span>
  </button>
  <nav id="nav-menu">
    <a href="/index.html">üè† Home</a>
    <a href="/yellow.html">üåü Yellow World</a>
    <a href="/status.html">üìä My Status</a>
    <a href="/gallery.html">üñºÔ∏è Gallery</a>
    <a href="/about.html">‚ÑπÔ∏è About</a>
    <div class="divider"></div>
    <a href="/api/auth/logout">üö™ Logout</a>
  </nav>
</div>

<!-- USER BAR -->
<div id="user-bar">
  <div style="position:relative">
    <img id="user-avatar">
    <span id="status-dot"></span>
  </div>
  <span id="user-name"></span>
</div>

<div class="container">
  <button class="play-btn" id="playBtn">
    <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
  </button>

  <div class="text-container" id="textContainer">
    <div class="welcome-text" id="welcomeText"></div>
    <div class="enter-text" id="enterText"></div>
    <div class="small-text" id="smallText"></div>

    <div class="x-connect" id="xConnect">
      <button class="x-btn" id="xBtn">
        <svg viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231z"/></svg>
      </button>
      <span class="connect-text">Connect with X</span>
    </div>

    <section id="badges-section">
      <p class="badges-title">Badges to collect in the Yellow World</p>
      <p class="badges-sub">Some are obvious.<br>Some are hidden.<br>Some are not for everyone.</p>

      <div id="badges-grid"></div>

      <div id="badge-info">
        <p id="badge-name"></p>
        <p id="badge-description"></p>
      </div>
    </section>
  </div>
</div>

<script>
const playBtn = document.getElementById('playBtn');
const textContainer = document.getElementById('textContainer');
const welcomeText = document.getElementById('welcomeText');
const enterText = document.getElementById('enterText');
const smallText = document.getElementById('smallText');
const xConnect = document.getElementById('xConnect');

let isAuthenticated = false;

// Toggle hamburger menu
function toggleMenu() {
  document.getElementById('hamburger-btn').classList.toggle('open');
  document.getElementById('nav-menu').classList.toggle('open');
}

// Close menu when clicking outside
document.addEventListener('click', (e) => {
  const menu = document.getElementById('hamburger-menu');
  if (!menu.contains(e.target)) {
    document.getElementById('hamburger-btn').classList.remove('open');
    document.getElementById('nav-menu').classList.remove('open');
  }
});

function typeWriter(el, text, speed) {
  return new Promise(r => {
    let i = 0;
    function t() {
      if (i < text.length) {
        el.innerHTML = text.slice(0, i + 1) + '<span class="cursor"></span>';
        i++;
        setTimeout(t, speed);
      } else {
        el.innerHTML = text;
        r();
      }
    }
    t();
  });
}

playBtn.onclick = async () => {
  playBtn.classList.add('hidden');
  textContainer.classList.add('visible');
  await typeWriter(welcomeText, 'WELCOME', 120);
  await typeWriter(enterText, 'Enter the Yellow World', 60);
  await typeWriter(smallText, 'Not everyone needs to go further.', 40);
  
  // Show X connect button only if not authenticated
  if (!isAuthenticated) {
    xConnect.classList.add('visible');
  }
};

document.getElementById('xBtn').onclick = () => location.href = '/api/auth/login';

/* ---------- STATUS + BADGES ---------- */
fetch('/api/user/status')
  .then(r => r.json())
  .then(d => {
    if (!d.authenticated) return;

    isAuthenticated = true;

    // Show hamburger menu
    document.getElementById('hamburger-menu').style.display = 'block';

    // Show user bar
    document.getElementById('user-bar').style.display = 'flex';
    document.getElementById('user-avatar').src = d.user.avatarUrl;
    document.getElementById('user-name').textContent = '@' + d.user.username;

    // Hide X connect button since already connected
    xConnect.style.display = 'none';

    // Show badges section
    document.getElementById('badges-section').style.display = 'block';

    const grid = document.getElementById('badges-grid');
    const info = document.getElementById('badge-info');
    const name = document.getElementById('badge-name');
    const desc = document.getElementById('badge-description');

    const defs = [
      { id: 'og', name: 'OG', desc: 'Early access ‚Äì first 24 hours' },
      { id: 'badge_2', name: '???', desc: 'Mystery badge' },
      { id: 'badge_3', name: '???', desc: 'Mystery badge' },
      { id: 'badge_4', name: '???', desc: 'Mystery badge' },
      { id: 'badge_5', name: '???', desc: 'Mystery badge' },
      { id: 'badge_6', name: '???', desc: 'Mystery badge' },
      { id: 'badge_7', name: '???', desc: 'Mystery badge' },
      { id: 'badge_8', name: '???', desc: 'Mystery badge' },
      { id: 'badge_9', name: '???', desc: 'Mystery badge' },
      { id: 'badge_10', name: '???', desc: 'Mystery badge' }
    ];

    defs.forEach(b => {
      const userBadge = d.badges.find(x => x.badge_id === b.id);
      const unlocked = !!userBadge;
      
      const el = document.createElement('div');
      el.className = 'badge' + (unlocked ? ' unlocked' : '');
      el.onclick = () => {
        info.style.display = 'block';
        if (unlocked) {
          name.textContent = userBadge.badge_name || b.name;
          desc.textContent = userBadge.description || b.desc;
        } else {
          name.textContent = '???';
          desc.textContent = 'This badge has not been unlocked yet';
        }
      };
      grid.appendChild(el);
    });
  });
</script>
</body>
</html>